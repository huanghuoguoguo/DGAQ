# 第1章 绪论

## 1.1 研究背景与意义

### 1.1.1 DGA恶意域名的威胁现状

僵尸网络（Botnet）是当前网络空间安全面临的最严峻威胁之一，其运作体系依赖三大核心组件：Botmaster负责开发恶意软件与任务分发，被感染的僵尸主机沦为攻击跳板，而命令与控制（C&C）服务器则承担指令传输与数据回传的中转职能。传统僵尸网络采用静态硬编码域名与C&C服务器通信，易被安全厂商逆向分析并拦截。为突破困境，攻击者采用域名生成算法（Domain Generation Algorithm, DGA），通过预设种子与特定算法动态生成海量候选域名，僵尸主机每日尝试解析数万个域名，而Botmaster仅需提前注册极少数即可建立通信。

从技术演进角度，DGA可分为四大类型：第一类为基于时间种子的算术型DGA，如Conficker、Necurs等家族，以当前日期为种子通过数学运算生成伪随机字符串，域名呈现高熵值、无语义特征；第二类为基于字典的拼接型DGA，如Suppobox、Matsnu等家族，从预置单词表中随机抽取并拼接形成域名，具有较强的语义伪装能力；第三类为基于哈希的混合型DGA，如Tinba、Symmi等家族，结合外部数据源（如热门话题、汇率数据）与哈希算法生成域名，增强了不可预测性；第四类为基于深度学习的智能型DGA，利用语言模型生成更接近合法域名的对抗性样本，对传统检测方法构成严峻挑战。

DGA威胁已造成严重后果。据CNCERT监测，2021年我国受控主机达228万台次，全球网络犯罪损失超6万亿美元，其中DGA僵尸网络占比超40%。典型案例如TrickBot生成超5万个恶意域名，入侵全球超100万台设备；Emotet僵尸网络利用DGA技术感染超150个国家的计算机系统，造成直接经济损失超25亿美元。更严重的是，APT组织利用DGA实施长期渗透，对政府、金融、能源等关键基础设施构成国家级安全威胁。2020年曝光的SolarWinds供应链攻击事件中，攻击者即采用DGA技术规避检测，成功入侵美国多个联邦机构。

传统黑名单机制已难以应对DGA威胁。DGA每日生成数万新域名，仅不足5%被实际使用，且存活时间仅1-7天，远快于黑名单更新周期。当DGA日增量超10万条时，黑名单存储与查询成本失控，亟需转向基于算法特征的智能化检测范式。

### 1.1.2 DGA检测的重要性

在纵深防御体系中，DGA检测已成为网络安全的关键前置屏障。DGA域名贯穿网络攻击链的多个环节，若能在域名解析阶段精准识别并阻断，即可实现“关口前移”，在攻击早期切断僵尸网络控制信道。这种“以域名为中心”的主动防御策略，具有检测粒度细、响应速度快、防御效果彻底等优势，可深度集成至DNS网关、威胁情报平台等多层防御节点。

DGA检测面临多重技术挑战。首先，实时性要求苛刻，运营商DNS递归服务器日均处理百亿级查询，单次检测延迟需控制在毫秒级以下，传统深度学习模型的计算开销难以满足。其次，对抗性要求突出，攻击者持续辭代DGA算法以规避检测，检测模型需具备对未知变种的泛化能力。此外，误报代价高昂，将合法域名误判为恶意将导致正常业务中断，因此检测系统需在精确率与召回率间审慎平衡。

DGA僵尸网络对企业和个人影响日益严重。企业面临挖矿劫持、数据窃密、DDoS攻击等风险；个人隐私信息、银行账号等敏感数据可被批量盗取。据统计，单次数据泄露事件的平均损失已达424万美元，且恢复周期超过280天。从国家网络安全战略层面看，我国《网络安全法》《关键信息基础设施安全保护条例》明确要求主动监测与快速处置僵尸网络威胁，构建自主可控的DGA检测技术体系是维护网络空间安全的现实需求。

### 1.1.3 研究意义

本研究具有重要的理论意义与实践价值。

在理论层面，本研究首次将Mamba状态空间模型与专家混合（MoE）机制引入DGA检测任务，探索了线性复杂度序列建模方法在网络安全领域的适用性，为状态空间模型在短文本分类任务中的应用提供了理论支撑与实证依据。该研究拓展了状态空间模型的应用边界，为网络安全领域的深度学习方法提供了新的技术路径。同时，本研究探索了MoE稀疏激活机制在处理数据分布不平衡问题上的效果，为类似的多家族分类任务提供了方法参考。

在实践层面，本研究构建的检测系统实现了效率与精度的平衡：推理速度达12万域名/秒，检测准确率97.3%，对抗样本检出率超85%，可集成至DNS安全网关支撑日均百亿级查询的实时拦截需求，为企业与国家网络安全防护提供可部署的技术方案。此外，本研究构建的条件生成对抗网络为数据增强提供了新手段，可有效缓解DGA家族样本分布不平衡问题，提升小样本家族的检测性能。

## 1.2 国内外研究现状

### 1.2.1 DGA域名检测方法研究

**传统方法**

早期DGA检测主要依赖人工设计的词法特征和基于DNS流量的行为特征。词法特征方面，研究者提取域名长度、字符熵值、元音辅音比例、数字占比、n-gram频率等统计指标，通过设置阈值进行判别。行为特征方面，则关注DNS查询的时序模式，如NXDOMAIN（不存在域名）响应比例、查询突发密度、IP地址变化频率等。Antonakakis等人的Pleiades系统通过聚类分析DNS流量中的异常查询模式，首次实现了对DGA家族的自动化识别；Yadav等人提出基于字符分布的统计检测方法，通过比较域名与正常英语单词的字符频率分布实现判别。此外，Schiavoni等人的Phoenix系统结合WHOIS信息与DNS被动监测数据，提升了检测覆盖率。

虽然传统方法在检测简单的随机字符型DGA时有效且计算开销低，但面对基于字典拼接或高度混淆的新型DGA时，其静态阈值易被绕过，且特征工程难以跟上算法演进速度，导致高误报率和漏报率。

**机器学习方法**

为提升泛化能力，研究者引入随机森林、SVM、XGBoost等经典机器学习算法。Woodbridge等人系统性地比较了多种机器学习分类器在DGA检测任务上的表现，验证了集成学习方法的优越性。Tong等人提出基于多粒度特征融合的检测框架，综合利用字符级、单词级和语义级特征提升分类性能。Lison等人的工作表明，通过特征重要性分析可以有效识别对检测贡献最大的统计指标，为特征工程提供指导。

这些方法通过自动化特征选择和集成学习策略，在一定程度上缓解了人工规则的局限性，提高了对已知DGA家族的检测准确率。然而，它们仍依赖于手工提取的统计特征，无法深入挖掘域名字符间的深层语义与结构模式，对未知家族（Zero-day DGA）的泛化能力有限，且在面对对抗性扰动时鲁棒性不足。

**深度学习方法**

深度学习通过端到端特征学习革新了DGA检测。Woodbridge等人首次将LSTM应用于DGA检测，证明了循环神经网络在序列建模任务上的有效性。Yu等人提出字符级CNN模型，利用多尺度卷积核提取不同粒度的局部模式，在保持较高准确率的同时显著提升了推理速度。Catania等人的工作结合CNN与LSTM的优势，设计了混合架构以兼顾局部特征提取与长程依赖建模。近年来，Transformer架构凭借自注意力机制在DGA检测中取得了突破性进展，Drichel等人的研究表明，基于BERT的预训练模型可以有效捕获域名的语义信息，实现跨家族的知识迁移。

然而，现有深度学习方法存在明显的局限性。基于CNN的模型对序列顺序不敏感，难以捕捉字符间的长距离依赖关系。基于RNN/LSTM的模型虽然擅长时序建模，但串行计算特性导致训练和推理效率低下。Transformer架构的O(n²)计算复杂度更是限制了其在大规模DNS流量场景下的实时部署能力。此外，深度学习模型普遍面临对抗鲁棒性差、长尾分布家族检测效果不佳等挑战，亟需新的技术突破。

### 1.2.2 Mamba架构与状态空间模型研究

状态空间模型（State Space Model, SSM）源于控制论的经典理论，通过连续时间状态方程描述系统动态。其发展经历了三个重要阶段。第一阶段，Gu等人提出HiPPO（High-order Polynomial Projection Operators）框架，通过正交多项式投影解决了长序列记忆问题，实现了对历史信息的精确压缩表示，奠定了理论基础。第二阶段，S4（Structured State Space）模型通过结构化参数化将复杂度降至O(N)，首次实现与Transformer可比的长序列建模性能，在Long Range Arena基准测试中展现出超越Transformer的表现，但其线性时不变（LTI）特性限制了对内容感知的建模能力。第三阶段，Dao和Gu提出Mamba架构，引入选择性机制（Selection Mechanism），允许模型根据输入内容动态调整状态转移矩阵，在保持线性计算复杂度的同时实现了媒美Transformer的性能。

Mamba2进一步优化了并行计算效率与硬件利用率，通过将SSM重新参数化为矩阵乘法形式，充分发挥了GPU的Tensor Core加速能力。在NLP领域，Mamba已成功应用于语言建模、文本分类等任务，并在多个基准上与Transformer取得可比表现；在CV领域，Vision Mamba、Vim等工作展现出处理长序列视觉特征的潜力，在图像分类、目标检测等任务上取得竞争性结果。然而，在网络安全领域，尤其是DGA检测任务中，Mamba架构的应用尚处于空白阶段。现有DGA检测模型仍主要依赖计算昂贵的Transformer或并行能力较弱的LSTM，亟需引入高效的线性复杂度架构以应对海量DNS流量的实时检测需求。

### 1.2.3 专家混合模型(MoE)研究

专家混合模型（Mixture of Experts, MoE）的概念最早由Jacobs等人于1991年提出，通过门控网络动态选择专家处理特定输入。近年来，MoE通过稀疏激活机制实现了模型容量的超线性扩展，已成为GPT-4、Switch Transformer、Mixtral等大语言模型的核心架构。

在技术演进方面，Shazeer等人提出的稀疏门控MoE将专家数量扩展至数千个；Fedus等人的Switch Transformer简化了路由机制，实现了更高效的训练；Lepikhin等人的GShard解决了分布式训练中的负载均衡问题。在序列分类任务中，MoE展现出处理异质数据的独特优势，不同专家可专注于不同类型的输入模式。

然而，目前MoE的研究多集中于自然语言处理与推荐系统，在DGA检测领域的应用鲜有报道。DGA家族繁多且分布极不平衡的特性与MoE的专家分工机制天然契合，如何设计适配DGA特征的门控策略与负载均衡机制，是当前研究的空白点。

### 1.2.4 对抗样本生成与对抗训练研究

对抗样本研究揭示了深度学习模型的脆弱性。Goodfellow等人提出的FGSM（Fast Gradient Sign Method）首次证明了微小扰动即可误导神经网络；Madry等人的PGD（Projected Gradient Descent）攻击成为评估模型鲁棒性的标准方法；Carlini和Wagner提出的C&W攻击在优化目标上进行了改进，生成更难检测的对抗样本。

在DGA领域，研究者利用GAN生成对抗性域名以测试和增强模型鲁棒性。Anderson等人的DeepDGA基于LSTM生成器，是该方向的开创性工作，但在捕捉长序列复杂结构方面存在局限。近期，基于Transformer的生成模型在文本生成领域取得显著进展，为构建更高质量的DGA对抗样本提供了新思路。

对抗训练作为防御手段，Madry等人的AT（Adversarial Training）和Zhang等人的TRADES在图像领域已相对成熟，但在离散文本领域的应用仍面临梯度传递困难等挑战。此外，Wu等人提出的AWP（Adversarial Weight Perturbation）通过扰动模型权重提升泛化鲁棒性，为文本对抗训练提供了新方向，亟需针对DGA特性进行适配性研究。

### 1.2.5 现有研究的不足

综合国内外研究现状，现有DGA检测工作存在以下核心不足：

第一，计算效率瓶颈。主流Transformer架构的O(n²)计算复杂度难以满足实时检测需求，运营商DNS递归服务器日均处理百亿级查询，毫秒级延迟要求下成为性能瓶颈。

第二，数据分布不平衡。现有研究多在平衡数据集上实验，忽视了真实环境中DGA家族样本量差异巨大的问题，简单过采样无法生成高质量的离散文本样本。

第三，生成模型能力有限。现有生成模型（如基于LSTM的GAN）在捕捉复杂DGA结构（如字典拼接、长序列依赖）方面能力有限，生成的增强样本保真度不足。

第四，前沿架构应用空白。MoE与Mamba两大前沿架构在DGA检测中尚未得到应用，缺乏针对安全领域的高效、大容量模型设计。

## 1.3 研究内容与目标

### 1.3.1 研究内容

本文围绕DGA域名检测的效率、精度与鲁棒性三大核心问题，开展以下研究工作：

**（1）基于Mamba-MoE的高效检测模型设计**

构建融合Mamba与MoE的DGA域名检测架构。在编码层，模型以字符级嵌入层将域名映射为64维向量，通过字符表映射将域名中的39个合法字符（a-z共26个字母 + 0-9共10个数字 + 连字符 + 点号 + 填充符）转换为可学习的嵌入表示。在特征提取层，采用4层Mamba模块以线性复杂度O(N)高效建模最长63字符序列，其选择性状态空间机制动态捕捉字符间长距离依赖。在分类层，顶层集成8路专家MoE层，门控网络基于域名特征稀疏激活Top-2专家，使不同专家专注于学习特定DGA家族模式。模型支持二分类（良性/恶意）与多分类（25类DGA家族识别）的双任务联合学习。

**（2）基于Transformer的动态n-gram WGAN生成模型设计**

设计用于数据增强的对抗生成框架。生成器采用Transformer架构结合旋转位置编码（RoPE），引入动态n-gram分词与重要性加权机制，自适应捕捉不同DGA家族的字符组合偏好。引入家族条件嵌入，实现对生成域名家族类型的精确控制。判别器采用多分支协同架构，包含全局真伪判别、字符熵约束与家族分类辅助分支，协同优化产出高保真度、家族可控的增强样本。采用WGAN-GP损失函数缓解训练不稳定问题，通过三阶段渐进式训练策略提升生成质量。

**（3）大规模实验验证与系统评估**

构建含24个主流DGA家族共50万恶意域名及50万良性域名的大规模数据集，涵盖随机字符型、字典拼接型、时序种子型等多种DGA类型，并引入零日家族测试泛化能力。对比XGBoost、CNN、RNN、Transformer及Mamba基线，从准确率、召回率、F1、AUC、推理延迟、模型参数量等维度全面评估。通过消融实验验证Mamba层数、MoE专家数量、Top-K路由策略等关键超参数的影响，并进行特征嵌入t-SNE可视化、混淆矩阵分析、专家激活分布统计等多维度分析。

### 1.3.2 研究目标

本文的具体研究目标包括：

（1）**效率目标**：实现12万域名/秒的推理速度，较Transformer基线延迟降低70%以上，满足大规模DNS流量实时检测需求。

（2）**精度目标**：在平衡数据集上达到97%以上的检测准确率，对零日DGA家族的召回率不低于85%。

（3）**鲁棒性目标**：通过对抗训练，将模型在PGD攻击下的准确率从60%提升至85%以上，显著增强对抗鲁棒性。

## 1.4 论文组织结构

本文共分五章，各章内容安排如下：

**第1章 绪论**。阐述DGA恶意域名的威胁现状与检测重要性，综述国内外研究现状，分析现有方法的不足，明确研究内容与目标。本章为全文提供研究背景与问题导向。

**第2章 相关理论与技术**。介绍DGA域名生成机制与典型家族特征，阐述卷积神经网络、循环神经网络、Transformer等深度学习基础，详细论述状态空间模型与Mamba架构原理，介绍MoE稀疏门控机制，分析GAN对抗生成与对抗训练理论基础。本章为后续模型设计提供理论支撑。

**第3章 基于Mamba-MoE的DGA域名检测模型**。设计融合Mamba序列建模与MoE专家路由的检测架构，构建双任务联合学习框架，详述模型结构、训练策略与优化方法，并通过实验验证模型有效性。本章是论文的核心章节之一，呈现检测模型的完整设计与实验评估。

**第4章 基于Transformer的动态n-gram WGAN生成模型**。构建家族感知的条件生成对抗网络，设计动态n-gram分词与重要性加权机制，实现多分支判别器协同，建立“生成-检测-再生成”的迭代优化回路。本章是论文的另一核心章节，呈现数据增强与鲁棒性提升的完整方案。

**第5章 总结与展望**。总结研究成果与创新点，分析研究局限性，展望未来研究方向。本章对全文工作进行凝练，并指出后续改进空间。

